# Лабораторная работа №2

**Тема:** Использование нотации C4 model для проектирования архитектуры программной системы
**Цель работы:** Получить опыт использования графической нотации для фиксации архитектурных решений.
**Ожидаемые результаты:**
1.	Диаграмма системного контекста (2 балла)
2.	Диаграмма контейнеров с пояснениями по выбору базового архитектурного стиля / архитектуры уровня приложений (при этом выбрать топологию, подразумевающую несколько модулей развертывания и наличие сетевого взаимодействия) (4 балла)
3.	Диаграмма компонентов для одного контейнера (2 балла)
4.	Диаграммы компонентов для остальных контейнеров (достаточно будет сделать ещё одну диаграмму компонентов) (2 балла)

---

**Тема:**  "Разработка веб-приложения для удалённого мониторинга и управления парком 3D-принтеров"

---

## Диаграмма системного контекста

![Image](https://github.com/user-attachments/assets/9b4898eb-db60-4044-81e7-761db4e24dcc)

**Описание:**
На диаграмме системного контекста представлено общее окружение системы PrinterHub и её взаимодействие с внешними участниками и программными сервисами. Центральным элементом диаграммы является система управления и мониторинга парка 3D-принтеров PrinterHub, которая объединяет пользователей различного назначения и физические устройства печати в единую информационную среду. В качестве пользователей системы выделены администратор, менеджер и технический специалист, каждый из которых выполняет разные функции в зависимости от своей роли. Администратор отвечает за настройку системы, контроль состояния принтеров и управление процессами печати. Менеджер использует систему для отслеживания выполнения заказов и анализа показателей работы, а технический специалист занимается регистрацией оборудования и его эксплуатационным обслуживанием.

Система PrinterHub взаимодействует с внешними аппаратными устройствами - 3D-принтерами, которые предоставляют телеметрию и принимают управляющие команды по сети. Каждый принтер рассматривается как внешняя по отношению к системе сущность, подключающаяся через сетевой интерфейс и поддерживающая обмен данными в режиме реального времени. Также на диаграмме отражено взаимодействие системы с сервисом push-уведомлений, который используется для информирования пользователей о состоянии печати, завершении заданий и возникновении ошибок.Таже система взаимодействует с внешней системой Slicing Service, которая преобразует файлы проекта в g-code.


## Диаграмма контейнеров

![Image](https://github.com/user-attachments/assets/1bcd5466-1aa3-49e8-abca-917946072b67)

**Описание:**
Диаграмма контейнеров отражает внутреннюю структуру системы PrinterHub и показывает разбиение программного решения на отдельные логические контейнеры, каждый из которых выполняет свою функцию и разворачивается как самостоятельный модуль. Пользователь взаимодействует с системой через веб-интерфейс, реализованный в виде клиентского одностраничного приложения, которое выполняет роль пользовательского входа во все функции системы. Обработка бизнес-логики, управление заданиями печати, работа с пользователями и маршрутизация команд осуществляется серверной частью - PrinterHub Controller, реализованной в виде API-сервиса.

Хранение данных организовано в виде двух подсистем: база данных используется для хранения метаданных, заказов и журналов, а файловое хранилище предназначено для размещения моделей, G-code файлов и изображений с камер наблюдения.

Взаимодействие с физическими 3D-принтерами вынесено в отдельный контейнер Printer Agent, который выполняет роль шлюза между программной системой и оборудованием, обеспечивая приём телеметрии и отправку управляющих команд. Для уведомлений о событиях используется внешний push-сервис, интеграция с которым выполняется через API.

**Выбор архитектурного стиля:**
В качестве архитектурного стиля в проекте выбран модульный монолит с асинхронной очередью задач, так как система разворачивается на одном вычислительном устройстве с ограниченными вычислительными ресурсами. Использование микросервисной архитектуры в данном случае было бы избыточным, поскольку привело бы к усложнению развертывания, увеличению потребления памяти и росту затрат на администрирование. Модульный монолит позволяет разместить всю систему в одном процессе или в пределах одного узла, при этом логически разделяя функциональные части на независимые программные модули. Это повышает читаемость кода, упрощает сопровождение и снижает риск взаимного влияния компонентов друг на друга. Применение очереди задач позволяет выполнять ресурсоёмкие операции, такие как генерация G-code и анализ моделей, вне основного потока обработки пользовательских запросов. В итоге обеспечивается приемлемая производительность системы и возможность последующего масштабирования отдельных компонентов без радикальной переработки архитектуры.

## Диаграмма компонентов (API-сервер PrinterHub Controller)

![Image](https://github.com/user-attachments/assets/1e1a3ff4-ac0c-48d6-a523-a5267e085766)

Диаграмма компонентов API-сервера показывает его внутреннюю архитектуру и отражает разбиение на функциональные модули, реализующие основную бизнес-логику системы. Центральным элементом является компонент REST и WebSocket-контроллеров, который обеспечивает взаимодействие с пользовательским интерфейсом и внешними сервисами. Через него проходят запросы на создание заданий, получение статусов печати, загрузку моделей и управление пользователями. Компонент управления пользователями отвечает за аутентификацию, проверку прав доступа и хранение информации о ролях.

Работа с 3D-моделями осуществляется через модуль управления моделями, который отвечает за загрузку, проверку и сохранение файлов во внешнем хранилище. Для планирования и контроля печати используется компонент-оркестратор заданий, который создаёт задания, назначает принтер и отслеживает их состояние. Генерация G-code выполняется через отдельный компонент оркестрации slicing, который размещает задачи в очереди сообщений и получает готовые данные от фоновых воркеров.

Компонент управления печатью координирует передачу управляющих команд в шлюз Printer Agent и контролирует жизненный цикл конкретного задания. Для приёма телеметрии реализован компонент мониторинга, который обрабатывает потоковые данные и обеспечивает их передачу в интерфейс пользователя. Отдельный компонент отвечает за контроль расходных материалов и проверяет наличие достаточного объёма филамента перед запуском задания. Интеграция с внешним сервисом уведомлений реализована через компонент отправки сообщений, который формирует уведомления и направляет их пользователям. Хранение структуры данных реализовано через слой репозиториев, инкапсулирующий работу с базой данных.

## Диаграмма компонентов (Printer Agent)

![Image](https://github.com/user-attachments/assets/1fea0478-4761-4e2d-be94-9145aa30f177)

Диаграмма компонентов Printer Agent демонстрирует архитектуру программного шлюза, обеспечивающего взаимодействие системы PrinterHub с физическими 3D-принтерами. Основным элементом является клиент связи с API-сервером, который обеспечивает двусторонний обмен данными и получение управляющих команд. Для обеспечения устойчивости работы используется локальная очередь заданий, позволяющая временно сохранять команды при сбоях сети или недоступности основного сервера.

Связь с принтером реализована через адаптер, который инкапсулирует сетевое взаимодействие по API и предоставляет унифицированный интерфейс для передачи команд и G-code файлов. Компонент сбора телеметрии принимает данные о температуре, ходе печати и состоянии оборудования, после чего отправляет их в центральный сервер. Также в агент встроен прокси видеопотока, который обеспечивает доступ к камерам наблюдения и формирует снимки для архива и диагностики.

Компонент мониторинга состояния контролирует доступность принтера и корректность соединения, выполняя повторные подключения при ошибках. Управление настройками оборудования осуществляется через конфигурационный модуль, в котором хранятся параметры подключения и профили принтеров. Для загрузки изображений и логов используется компонент клиента объектного хранилища, благодаря которому обеспечивается централизованное хранение данных. В совокупности эти модули обеспечивают автономную и устойчивую работу Printer Agent даже при нестабильном соединении с основной системой.